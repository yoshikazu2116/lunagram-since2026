<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å¿ƒç†å¿ƒæœˆé‘‘å®š - LUNAGRAM</title>
  <style>
    :root{
      --bg:#fbfaf6;
      --ink:#1b1f2a;
      --muted:#6b7280;
      --card:#ffffffcc;
      --line:#e7e4dc;
      --shadow:0 10px 30px rgba(0,0,0,.06);
      --radius:18px;
      --accent:#7c83ff;
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", "Yu Gothic", "Meiryo", sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1000px 700px at 70% 20%, rgba(124,131,255,.18), transparent 60%),
        radial-gradient(900px 600px at 20% 80%, rgba(255,199,102,.16), transparent 60%),
        linear-gradient(180deg, #fffdf6, #fbfaf6);
      overflow-x:hidden;
    }
    .noise{
      position:fixed; inset:0;
      pointer-events:none;
      background-image:
        radial-gradient(circle at 20% 30%, rgba(0,0,0,.05) 1px, transparent 1px),
        radial-gradient(circle at 70% 60%, rgba(0,0,0,.04) 1px, transparent 1px),
        radial-gradient(circle at 40% 80%, rgba(0,0,0,.03) 1px, transparent 1px);
      background-size: 140px 140px, 180px 180px, 220px 220px;
      opacity:.35;
      mix-blend-mode:multiply;
    }
    .wrap{max-width:1100px; margin:0 auto; padding:28px 18px 60px;}
    .top{
      display:flex; align-items:center; justify-content:center; gap:10px;
      margin-top:14px;
    }
    .moon{
      width:28px; height:28px; display:inline-block;
      background: radial-gradient(circle at 35% 40%, #ffffff, #cfd4ff);
      border-radius:999px;
      box-shadow: inset -6px 0 0 rgba(124,131,255,.35);
    }
    .brand{
      text-align:center;
      line-height:1.05;
    }
    .brand h1{margin:0; font-size:28px; font-weight:800; letter-spacing:.08em;}
    .brand .sub{margin-top:6px; font-size:12px; letter-spacing:.28em; color:var(--accent); font-weight:800;}
    .namePill{
      margin:18px auto 22px;
      width:fit-content;
      padding:10px 22px;
      background:rgba(255,255,255,.75);
      border:1px solid var(--line);
      border-radius:999px;
      box-shadow: var(--shadow);
      font-weight:700;
    }
    .grid{
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:18px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
    }
    .cardPad{padding:16px 16px;}
    .row{display:flex; align-items:center; justify-content:space-between; gap:14px;}
    .label{font-size:12px; letter-spacing:.06em; color:var(--muted); font-weight:800;}
    .value{font-size:14px; font-weight:700;}
    .bigValue{font-size:18px; font-weight:900;}
    .sectionTitle{
      display:flex; align-items:center; gap:10px;
      font-weight:900; font-size:14px;
      margin-bottom:10px;
    }
    .icon{
      width:18px; height:18px; display:inline-flex; align-items:center; justify-content:center;
      color:var(--accent);
    }
    .divider{height:1px; background:var(--line); margin:12px 0;}
    .kv{
      display:grid;
      grid-template-columns: 1fr auto;
      row-gap:10px;
      column-gap:14px;
      align-items:center;
      padding:8px 2px;
    }
    .chip{
      font-size:12px;
      padding:3px 8px;
      border:1px solid var(--line);
      border-radius:999px;
      background:rgba(255,255,255,.75);
      color:var(--muted);
      font-weight:800;
    }
    .list{
      margin:0; padding:0; list-style:none;
    }
    .list li{
      padding:9px 10px;
      border:1px solid var(--line);
      border-radius:12px;
      background:rgba(255,255,255,.65);
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:8px;
      gap:12px;
    }
    .list li:last-child{margin-bottom:0;}
    .cycleYear{font-weight:900;}
    .cycleText{font-weight:700; color:var(--muted);}
    .star{
      font-size:12px; font-weight:900; color:#d97706;
      padding:3px 10px; border-radius:999px;
      border:1px solid rgba(217,119,6,.3);
      background: rgba(255,237,213,.75);
      white-space:nowrap;
    }
    .empty{
      padding:36px 16px;
      text-align:center;
      color:var(--muted);
      font-weight:700;
    }
    .emptyIcon{
      width:44px; height:44px; margin:0 auto 10px;
      border-radius:14px;
      border:1px dashed var(--line);
      display:flex; align-items:center; justify-content:center;
      color:var(--muted);
      background:rgba(255,255,255,.55);
    }
    .controls{
      margin-top:16px;
      display:flex; flex-wrap:wrap; gap:10px;
      align-items:center;
      justify-content:center;
    }
    button{
      appearance:none; border:1px solid var(--line);
      background:rgba(255,255,255,.78);
      color:var(--ink);
      border-radius:12px;
      padding:9px 12px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(0,0,0,.04);
      transition: transform .08s ease, background .15s ease;
    }
    button:hover{transform: translateY(-1px);}
    button.primary{
      border-color: rgba(124,131,255,.35);
      background: rgba(124,131,255,.12);
      color:#2a2e66;
    }
    button.danger{
      border-color: rgba(239,68,68,.28);
      background: rgba(239,68,68,.10);
      color:#7a1b1b;
    }
    .hint{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      text-align:center;
      font-weight:700;
    }
    .overlay{
      position:fixed; inset:0;
      background: rgba(10,12,18,.35);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .modal{
      width:min(860px, 100%);
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 25px 70px rgba(0,0,0,.22);
      border: 1px solid rgba(0,0,0,.08);
      overflow:hidden;
    }
    .modalHead{
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between;
      background: linear-gradient(180deg, #fff, #fbfaf6);
      border-bottom: 1px solid var(--line);
    }
    .modalHead .title{font-weight:900;}
    .modalBody{padding:12px 14px;}
    textarea{
      width:100%;
      min-height:260px;
      resize:vertical;
      border-radius:14px;
      border:1px solid var(--line);
      padding:12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:12px;
      line-height:1.55;
      outline:none;
    }
    .err{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(239,68,68,.28);
      background: rgba(239,68,68,.08);
      color:#7a1b1b;
      font-weight:800;
      display:none;
    }
    .foot{
      margin-top:28px;
      text-align:center;
      color:rgba(107,114,128,.75);
      font-size:12px;
      font-weight:700;
      letter-spacing:.08em;
    }
  </style>
</head>
<body>
  <div class="noise"></div>
  <div class="wrap">
    <div class="top">
      <span class="moon" aria-hidden="true"></span>
      <div class="brand">
        <h1>å¿ƒç†å¿ƒæœˆé‘‘å®š</h1>
        <div class="sub">LUNAGRAM</div>
      </div>
    </div>

    <div id="namePill" class="namePill">No Name</div>

    <div class="grid">
      <div class="leftCol">
        <div class="card cardPad" style="margin-bottom:18px;">
          <div class="sectionTitle">
            <span class="icon" aria-hidden="true">âœ¦</span>
            <span>SOUL BASE</span>
          </div>
          <div class="row">
            <div class="value" id="soulBase">ãƒ¼</div>
            <div class="chip">é­‚ã®åŸºç›¤</div>
          </div>
        </div>

        <div class="card cardPad" style="margin-bottom:18px;">
          <div class="sectionTitle">
            <span class="icon" aria-hidden="true">â˜†</span>
            <span>å‘½å¼ãƒ»å±æ€§</span>
          </div>
          <div class="divider"></div>
          <div class="kv">
            <div class="label">é‹å‘½æ•°</div><div class="bigValue" id="fateNumber">ãƒ¼</div>
            <div class="label">é™°é™½äº”è¡Œ</div><div class="value" id="yinYang">ãƒ¼</div>
            <div class="label">é‹å‘½æœˆ</div><div class="value" id="fateMonth">ãƒ¼</div>
            <div class="label">ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼</div><div class="value" id="color">ãƒ¼</div>
          </div>
        </div>

        <div class="card cardPad" style="margin-bottom:18px;">
          <div class="sectionTitle">
            <span class="icon" aria-hidden="true">ğŸ’§</span>
            <span>ã‚ªã‚¤ãƒ«</span>
          </div>
          <div class="divider"></div>
          <ul id="oilList" class="list"></ul>
          <div id="oilEmpty" class="empty" style="display:none;">ãƒ¼</div>
        </div>

        <div class="card cardPad">
          <div class="sectionTitle">
            <span class="icon" aria-hidden="true">ğŸ“˜</span>
            <span>æ•™ç§‘æ›¸ãƒšãƒ¼ã‚¸</span>
          </div>
          <div class="divider"></div>
          <div class="kv">
            <div class="label">å®¿å‘½æœˆãƒšãƒ¼ã‚¸</div><div class="value" id="destinyMonthPage">ãƒ¼</div>
            <div class="label">å®¿å‘½æ•°ãƒšãƒ¼ã‚¸</div><div class="value" id="destinyNumberPage">ãƒ¼</div>
          </div>
        </div>
      </div>

      <div class="rightCol">
        <div class="card cardPad">
          <div class="sectionTitle">
            <span class="icon" aria-hidden="true">ğŸ—“</span>
            <span>12å¹´é‹å‘½ã‚µã‚¤ã‚¯ãƒ«</span>
          </div>
          <div class="divider"></div>
          <div id="cycleEmpty" class="empty">
            <div class="emptyIcon" aria-hidden="true">ğŸ“…</div>
            ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“
          </div>
          <ul id="cycleList" class="list" style="display:none;"></ul>
        </div>

        <div class="controls">
          <button class="primary" id="btnEdit">ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›</button>
          <button id="btnSample">ã‚µãƒ³ãƒ—ãƒ«</button>
          <button id="btnReset">åˆæœŸåŒ–</button>
          <button class="danger" id="btnClear">å…¨æ¶ˆå»</button>
        </div>
        <div class="hint">ã“ã“ã«ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</div>
      </div>
    </div>

    <div class="foot">Spiritual Journey Map</div>
  </div>

  <div id="overlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="ãƒ‡ãƒ¼ã‚¿ç·¨é›†">
      <div class="modalHead">
        <div class="title">ãƒ‡ãƒ¼ã‚¿ç·¨é›†</div>
        <div class="row" style="gap:8px;">
          <button id="btnSave" class="primary">ä¿å­˜</button>
          <button id="btnClose">é–‰ã˜ã‚‹</button>
        </div>
      </div>
      <div class="modalBody">
        <textarea id="editor" spellcheck="false" placeholder='ã“ã“ã«JSONã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„'></textarea>
        <div id="errBox" class="err"></div>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "lunagram_profile_v1";

    const SAMPLE_DATA = {
      "åå‰":"ãƒ†ã‚¹ãƒˆå››éƒ",
      "ç”Ÿå¹´æœˆæ—¥":"2018å¹´2æœˆ8æ—¥ï¼ˆå¹³æˆ30å¹´ï¼‰",
      "ã‚½ã‚¦ãƒ«ãƒ™ãƒ¼ã‚¹":"A(ã‚¢ãƒãƒ†ãƒ©ã‚¹)",
      "é‹å‘½æ•°":"08ï¼‹",
      "å®¿å‘½æœˆ":"è€æœˆ",
      "å®¿å‘½æœˆãƒšãƒ¼ã‚¸":"åˆç´šç·¨132ãƒšãƒ¼ã‚¸",
      "å®¿å‘½æ•°ãƒšãƒ¼ã‚¸":"åˆç´šç·¨136ãƒšãƒ¼ã‚¸",
      "é‹å‘½æœˆ":"æº€æœˆ",
      "color":"è‹¥è‘‰è‰²",
      "é™°é™½äº”è¡Œ":"é‡‘ï¼",
      "ã‚ªã‚¤ãƒ«ä¸€è¦§":["ãƒ†ã‚£ãƒ¼ãƒˆãƒªãƒ¼","ãƒ¦ãƒ¼ã‚«ãƒª","ã‚µã‚¤ãƒ—ãƒ¬ã‚¹"],
      "é‹å‘½ã‚µã‚¤ã‚¯ãƒ«":[
        "2017å¹´ã€ä¸‹å¼¦ï¼œå¿è€ï¼ã€‘æ€¥å¤‰",
        "2018å¹´ã€ä¸‹å¼¦ï¼œå¿è€ï¼ã€‘è€ãˆã‚‹",
        "2019å¹´ã€ä¸‹å¼¦ï¼œå¿è€ï¼ã€‘æ¸…ç®—",
        "2020å¹´ã€æ–°æœˆï¼œåŠªåŠ›ï¼ã€‘ã‚¹ã‚¿ãƒ¼ãƒˆ",
        "2021å¹´ã€æ–°æœˆï¼œåŠªåŠ›ï¼ã€‘åŠªåŠ›",
        "2022å¹´ã€æ–°æœˆï¼œåŠªåŠ›ï¼ã€‘æ±ºå®š",
        "2023å¹´ã€ä¸Šå¼¦ï¼œæ³¢ä¹±ï¼ã€‘èª˜æƒ‘",
        "2024å¹´ã€ä¸Šå¼¦ï¼œæ³¢ä¹±ï¼ã€‘å¸Œæœ›",
        "2025å¹´ã€ä¸Šå¼¦ï¼œæ³¢ä¹±ï¼ã€‘æ²¹æ–­",
        "2026å¹´ã€æº€æœˆï¼œå®Ÿã‚Šï¼ã€‘ã”ç¸ï¼ˆâ˜…ç¾åœ¨åœ°ï¼‰",
        "2027å¹´ã€æº€æœˆï¼œå®Ÿã‚Šï¼ã€‘ãŠé‡‘ãƒ»åŠ›",
        "2028å¹´ã€æº€æœˆï¼œå®Ÿã‚Šï¼ã€‘å‹•æº"
      ]
    };

    const EMPTY_DATA = {
      "åå‰":"",
      "ç”Ÿå¹´æœˆæ—¥":"",
      "ã‚½ã‚¦ãƒ«ãƒ™ãƒ¼ã‚¹":"",
      "é‹å‘½æ•°":"",
      "å®¿å‘½æœˆ":"",
      "å®¿å‘½æœˆãƒšãƒ¼ã‚¸":"",
      "å®¿å‘½æ•°ãƒšãƒ¼ã‚¸":"",
      "é‹å‘½æœˆ":"",
      "color":"",
      "é™°é™½äº”è¡Œ":"",
      "ã‚ªã‚¤ãƒ«ä¸€è¦§":[],
      "é‹å‘½ã‚µã‚¤ã‚¯ãƒ«":[]
    };

    function safeString(v){
      if (typeof v === "string") return v;
      if (v === null || v === undefined) return "";
      return String(v);
    }

    function parseCycleItem(itemStr){
      const s = safeString(itemStr);
      const isCurrent = s.includes("â˜…");
      const yearMatch = s.match(/^(\d{4})å¹´/);
      const year = yearMatch ? yearMatch[1] : "";
      const rest = yearMatch ? s.slice(yearMatch[0].length) : s;
      return { year, text: rest.trim(), isCurrent };
    }

    function validateProfile(obj){
      const requiredKeys = ["åå‰","ç”Ÿå¹´æœˆæ—¥","ã‚½ã‚¦ãƒ«ãƒ™ãƒ¼ã‚¹","é‹å‘½æ•°","å®¿å‘½æœˆ","å®¿å‘½æœˆãƒšãƒ¼ã‚¸","å®¿å‘½æ•°ãƒšãƒ¼ã‚¸","é‹å‘½æœˆ","color","é™°é™½äº”è¡Œ","ã‚ªã‚¤ãƒ«ä¸€è¦§","é‹å‘½ã‚µã‚¤ã‚¯ãƒ«"];
      for (const k of requiredKeys){
        if (!(k in obj)) return `ã‚­ãƒ¼ã€Œ${k}ã€ãŒã‚ã‚Šã¾ã›ã‚“ã€‚`;
      }
      if (!safeString(obj["ç”Ÿå¹´æœˆæ—¥"]).includes("ï¼ˆ") || !safeString(obj["ç”Ÿå¹´æœˆæ—¥"]).includes("ï¼‰")){
        return "ç”Ÿå¹´æœˆæ—¥ãŒå’Œæš¦è¾¼ã¿ã®å½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¾‹ 1982å¹´1æœˆ1æ—¥ï¼ˆæ˜­å’Œ57å¹´ï¼‰";
      }
      if (!Array.isArray(obj["ã‚ªã‚¤ãƒ«ä¸€è¦§"]) || obj["ã‚ªã‚¤ãƒ«ä¸€è¦§"].length < 1){
        return "ã‚ªã‚¤ãƒ«ä¸€è¦§ãŒç©ºã§ã™ã€‚";
      }
      const banned = ["ä¸æ˜","ä¸è©³","ãªã—","æœªå–å¾—","æŠ½å‡ºä¸å¯","ã‚½ãƒ¼ã‚¹","å­˜åœ¨ã—ãªã„"];
      for (const it of obj["ã‚ªã‚¤ãƒ«ä¸€è¦§"]){
        const s = safeString(it);
        for (const b of banned){
          if (s.includes(b)) return "ã‚ªã‚¤ãƒ«ä¸€è¦§ã«ä»£æ›¿èªãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚";
        }
      }
      if (!Array.isArray(obj["é‹å‘½ã‚µã‚¤ã‚¯ãƒ«"]) || obj["é‹å‘½ã‚µã‚¤ã‚¯ãƒ«"].length !== 12){
        return "é‹å‘½ã‚µã‚¤ã‚¯ãƒ«ã¯12ä»¶ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚";
      }
      let starCount = 0;
      for (const it of obj["é‹å‘½ã‚µã‚¤ã‚¯ãƒ«"]){
        if (safeString(it).includes("â˜…")) starCount++;
      }
      if (starCount !== 1){
        return "é‹å‘½ã‚µã‚¤ã‚¯ãƒ«ã®ï¼ˆâ˜…ç¾åœ¨åœ°ï¼‰ã¯1ä»¶ã ã‘å¿…è¦ã§ã™ã€‚";
      }
      if (!obj["é‹å‘½ã‚µã‚¤ã‚¯ãƒ«"].some(x => safeString(x).startsWith("2026å¹´") && safeString(x).includes("â˜…"))){
        return "2026å¹´ã®è¦ç´ ã«ã ã‘ï¼ˆâ˜…ç¾åœ¨åœ°ï¼‰ãŒå¿…è¦ã§ã™ã€‚";
      }
      return "";
    }

    function render(profile){
      const name = safeString(profile["åå‰"]).trim() || "No Name";
      document.getElementById("namePill").textContent = name;

      document.getElementById("soulBase").textContent = safeString(profile["ã‚½ã‚¦ãƒ«ãƒ™ãƒ¼ã‚¹"]) || "ãƒ¼";
      document.getElementById("fateNumber").textContent = safeString(profile["é‹å‘½æ•°"]) || "ãƒ¼";
      document.getElementById("yinYang").textContent = safeString(profile["é™°é™½äº”è¡Œ"]) || "ãƒ¼";
      document.getElementById("fateMonth").textContent = safeString(profile["é‹å‘½æœˆ"]) || "ãƒ¼";
      document.getElementById("color").textContent = safeString(profile["color"]) || "ãƒ¼";
      document.getElementById("destinyMonthPage").textContent = safeString(profile["å®¿å‘½æœˆãƒšãƒ¼ã‚¸"]) || "ãƒ¼";
      document.getElementById("destinyNumberPage").textContent = safeString(profile["å®¿å‘½æ•°ãƒšãƒ¼ã‚¸"]) || "ãƒ¼";

      const oils = Array.isArray(profile["ã‚ªã‚¤ãƒ«ä¸€è¦§"]) ? profile["ã‚ªã‚¤ãƒ«ä¸€è¦§"] : [];
      const oilUl = document.getElementById("oilList");
      const oilEmpty = document.getElementById("oilEmpty");
      oilUl.innerHTML = "";
      if (oils.length === 0){
        oilEmpty.style.display = "block";
      }else{
        oilEmpty.style.display = "none";
        for (const o of oils){
          const li = document.createElement("li");
          const left = document.createElement("div");
          left.className = "value";
          left.textContent = safeString(o);
          li.appendChild(left);
          oilUl.appendChild(li);
        }
      }

      const cycles = Array.isArray(profile["é‹å‘½ã‚µã‚¤ã‚¯ãƒ«"]) ? profile["é‹å‘½ã‚µã‚¤ã‚¯ãƒ«"] : [];
      const cycleUl = document.getElementById("cycleList");
      const cycleEmpty = document.getElementById("cycleEmpty");
      cycleUl.innerHTML = "";
      if (cycles.length === 0){
        cycleEmpty.style.display = "block";
        cycleUl.style.display = "none";
      }else{
        cycleEmpty.style.display = "none";
        cycleUl.style.display = "block";
        for (const c of cycles){
          const parsed = parseCycleItem(c);
          const li = document.createElement("li");

          const left = document.createElement("div");
          left.style.display = "flex";
          left.style.flexDirection = "column";
          left.style.gap = "2px";

          const y = document.createElement("div");
          y.className = "cycleYear";
          y.textContent = parsed.year ? `${parsed.year}å¹´` : "";
          const t = document.createElement("div");
          t.className = "cycleText";
          t.textContent = parsed.text;

          left.appendChild(y);
          left.appendChild(t);
          li.appendChild(left);

          if (parsed.isCurrent){
            const badge = document.createElement("div");
            badge.className = "star";
            badge.textContent = "ç¾åœ¨åœ°";
            li.appendChild(badge);
          }
          cycleUl.appendChild(li);
        }
      }
    }

    function loadInitial(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return JSON.parse(JSON.stringify(EMPTY_DATA));
        const obj = JSON.parse(raw);
        return { ...JSON.parse(JSON.stringify(EMPTY_DATA)), ...obj };
      }catch(e){
        return JSON.parse(JSON.stringify(EMPTY_DATA));
      }
    }

    function openEditor(text){
      document.getElementById("editor").value = text || "";
      hideError();
      const ov = document.getElementById("overlay");
      ov.style.display = "flex";
      ov.setAttribute("aria-hidden","false");
    }

    function closeEditor(){
      const ov = document.getElementById("overlay");
      ov.style.display = "none";
      ov.setAttribute("aria-hidden","true");
    }

    function showError(msg){
      const box = document.getElementById("errBox");
      box.textContent = msg;
      box.style.display = "block";
    }
    function hideError(){
      const box = document.getElementById("errBox");
      box.textContent = "";
      box.style.display = "none";
    }

    let profile = loadInitial();
    render(profile);

    document.getElementById("btnEdit").addEventListener("click", () => {
      openEditor(JSON.stringify(profile, null, 2));
    });
    document.getElementById("btnClose").addEventListener("click", () => closeEditor());

    document.getElementById("btnSave").addEventListener("click", () => {
      try{
        const text = document.getElementById("editor").value.trim();
        const obj = JSON.parse(text);
        const err = validateProfile(obj);
        if (err){
          showError(err);
          return;
        }
        profile = obj;
        localStorage.setItem(STORAGE_KEY, JSON.stringify(profile));
        render(profile);
        closeEditor();
      }catch(e){
        showError("JSONã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ã‚«ãƒ³ãƒã‚„æ‹¬å¼§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      }
    });

    document.getElementById("btnSample").addEventListener("click", () => {
      if (!confirm("ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ")) return;
      profile = JSON.parse(JSON.stringify(SAMPLE_DATA));
      localStorage.setItem(STORAGE_KEY, JSON.stringify(profile));
      render(profile);
    });

    document.getElementById("btnReset").addEventListener("click", () => {
      if (!confirm("åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ")) return;
      profile = JSON.parse(JSON.stringify(EMPTY_DATA));
      localStorage.setItem(STORAGE_KEY, JSON.stringify(profile));
      render(profile);
    });

    document.getElementById("btnClear").addEventListener("click", () => {
      if (!confirm("å®Œå…¨ã«æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ")) return;
      localStorage.removeItem(STORAGE_KEY);
      profile = JSON.parse(JSON.stringify(EMPTY_DATA));
      render(profile);
    });

    document.getElementById("overlay").addEventListener("click", (e) => {
      if (e.target && e.target.id === "overlay") closeEditor();
    });
  </script>
</body>
</html>
